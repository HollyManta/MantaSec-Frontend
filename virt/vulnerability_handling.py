import security_functions

def skipVuln(name):
    skipMe =    [
                'Ethernet MAC Addresses',
                'Traceroute Information',
                'Device Type',
                'Service Detection',
                'VMware ESX/GSX Server detection',
                'Nessus Scan Information',
                'Local Checks Not Enabled (info)',
                'TCP/IP Timestamps Supported',
                'OS Identification',
                'Microsoft Windows SMB Service Detection',
                'OS Identification and Installed Software Enumeration over SSH v2 (Using New SSH Library)',
                'Authenticated Check : OS Name and Installed Package Enumeration',
                'Common Platform Enumeration (CPE)',
                'Microsoft Windows SMB2 Dialects Supported (remote check)',
                'Microsoft Windows SMB Versions Supported (remote check)',
                'Microsoft Windows NTLMSSP Authentication Request Remote Network Name Disclosure',
                'Windows NetBIOS / SMB Remote Host Information Disclosure',
                'DCE Services Enumeration',
                'SSL Root Certification Authority Certificate Information',
                'SSL Certificate Information',
                'SSL / TLS Versions Supported',
                'HyperText Transfer Protocol (HTTP) Information',
                'Nessus SYN scanner',
                'SSL Certificate Expiry - Future Expiry',
                'OpenSSL Detection',
                'Additional DNS Hostnames',
                'Apache HTTP Server Version',
                'Web Server No 404 Error Code Check',
                'SSL Cipher Suites Supported',
                'Web Server robots.txt Information Disclosure',
                'HTTP Server Type and Version'
                ]

    if name in skipMe:
        return True
    else:
        return False

def addVuln(vulnlist, name, affected, risk):
    affected = str.join(", ", affected)

    # TODO - turn this into a template
    vulnlist += '<div class="row">'
    vulnlist += '<div class="widget-one">'
    vulnlist += '<div class="widget vuln-' + security_functions.cleanRisk(risk) + '-widget">'
    vulnlist += '<h3 class="">' + security_functions.entityEncode(name) + '</h3>'
    #vulnlist += '<p class="vuln-desc">' + vuln[2] + '</p>'
    vulnlist += '<p class="vuln-hosts"><b>Affected hosts:</b> ' + security_functions.entityEncode(affected) + '</p>'
    vulnlist += '</div>'
    vulnlist += '</div>'
    vulnlist += '</div>'
    return vulnlist

def orderVulns(vulns):
    vulnOrder = ["Critical", "High", "Medium", "Low", "None"]
    vulnlist = ""

    for rating in vulnOrder:
        for vuln in vulns:
            if vuln["risk"] == rating:
                if not skipVuln(vuln["name"]):
                    vulnlist = addVuln(vulnlist, vuln["name"], vuln["affected"], vuln["risk"])

    return vulnlist